<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>NeuraPal</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body,html{width:100%;height:100%;overflow:hidden;background:#1B2A4A;font-family:-apple-system,BlinkMacSystemFont,'Inter',sans-serif}
.shell{position:fixed;inset:0;background:#1B2A4A;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:100;transition:opacity .4s}
.shell.hide{opacity:0;pointer-events:none}
.logo{font-size:2rem;font-weight:800;color:#fff;letter-spacing:-.02em}
.logo span{color:#3B82F6}
.subtitle{color:rgba(255,255,255,.5);font-size:.85rem;margin-top:.5rem}
.spinner{margin-top:1.5rem;width:28px;height:28px;border:3px solid rgba(255,255,255,.15);border-top-color:#3B82F6;border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.offline{display:none;text-align:center;margin-top:2rem;max-width:300px}
.offline.show{display:block}
.offline p{color:rgba(255,255,255,.6);font-size:.85rem;line-height:1.6;margin-bottom:1.25rem}
.offline button{background:#3B82F6;color:#fff;border:none;padding:.75rem 2rem;border-radius:999px;font-size:.9rem;font-weight:600;cursor:pointer;font-family:inherit;min-height:48px;-webkit-tap-highlight-color:transparent;transition:all .2s}
.offline button:active{transform:scale(.96);opacity:.8}
.status{color:rgba(255,255,255,.35);font-size:.7rem;margin-top:1rem;position:absolute;bottom:calc(2rem + env(safe-area-inset-bottom,0px))}
</style>
</head>
<body>
<div class="shell" id="shell">
    <div class="logo">Neura<span>Pal</span></div>
    <div class="subtitle">Your AI Health Butler</div>
    <div class="spinner" id="spinner"></div>
    <div class="offline" id="offline">
        <p>Can't connect right now. Check your internet connection and try again.</p>
        <button onclick="tryConnect()">Try Again</button>
    </div>
    <div class="status" id="status">Connecting...</div>
</div>

<script>
// Use Capacitor's injected bridge directly â€” no bundler needed
function initNative() {
    if (!window.Capacitor || !window.Capacitor.Plugins) return;
    var P = window.Capacitor.Plugins;
    try { if (P.StatusBar) P.StatusBar.setStyle({ style: 'DARK' }); } catch(e) {}
    try { if (P.SplashScreen) P.SplashScreen.hide(); } catch(e) {}
}

function checkConnection(timeout) {
    timeout = timeout || 8000;
    return new Promise(function(resolve) {
        var controller = new AbortController();
        var timer = setTimeout(function() { controller.abort(); resolve(false); }, timeout);
        fetch('https://neurapal.mentiumlabs.com/favicon.png', {
            method: 'HEAD',
            mode: 'no-cors',
            signal: controller.signal,
            cache: 'no-store'
        })
        .then(function() { clearTimeout(timer); resolve(true); })
        .catch(function() { clearTimeout(timer); resolve(false); });
    });
}

function boot() {
    var status = document.getElementById('status');
    var spinner = document.getElementById('spinner');
    var offline = document.getElementById('offline');

    status.textContent = 'Initializing...';
    initNative();

    status.textContent = 'Connecting...';
    checkConnection().then(function(online) {
        if (online) {
            status.textContent = 'Loading NeuraPal...';
            setTimeout(function() {
                window.location.href = 'https://neurapal.mentiumlabs.com/';
            }, 300);
        } else {
            spinner.style.display = 'none';
            offline.classList.add('show');
            status.textContent = 'No connection';
        }
    });
}

function tryConnect() {
    var spinner = document.getElementById('spinner');
    var offline = document.getElementById('offline');
    var status = document.getElementById('status');
    spinner.style.display = 'block';
    offline.classList.remove('show');
    status.textContent = 'Retrying...';

    // Haptic feedback on retry
    try {
        if (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.Haptics) {
            window.Capacitor.Plugins.Haptics.impact({ style: 'LIGHT' });
        }
    } catch(e) {}

    checkConnection().then(function(online) {
        if (online) {
            status.textContent = 'Connected!';
            setTimeout(function() {
                window.location.href = 'https://neurapal.mentiumlabs.com/';
            }, 200);
        } else {
            spinner.style.display = 'none';
            offline.classList.add('show');
            status.textContent = 'Still offline';
        }
    });
}

// Wait for Capacitor bridge to be ready, then boot
if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(boot, 50);
} else {
    document.addEventListener('DOMContentLoaded', function() { setTimeout(boot, 50); });
}
</script>
</body>
</html>
